# =============================================================================
# И CONFIGURACIN DE TEST (Catalog Service)
# Ruta: src/test/resources/application-test.yml
# =============================================================================

server:
  # Puerto aleatorio (-1 o 0) para ejecuci贸n concurrente segura en CI/CD
  port: -1

spring:
  application:
    name: catalog-service-test

  #  VITAL: PERMITE SOBRESCRIBIR BEANS
  # Permite que TestConfig reemplace el Storage y PubSub reales con Mocks.
  main:
    allow-bean-definition-overriding: true

  # BASE DE DATOS (Gestionada por Testcontainers)
  # Testcontainers inyectar谩 la URL real de Docker din谩micamente.
  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://localhost:5432/test_db
    username: test
    password: test

  # JPA / HIBERNATE
  jpa:
    # create-drop: Borra la BD al terminar la suite
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        format_sql: true
        # 锔 CRTICO: Dialecto PostGIS
        # Sin esto, los tests espaciales (ST_DWithin) fallar谩n en H2/Testcontainers
        dialect: org.hibernate.spatial.dialect.postgis.PostgisPG95Dialect

  # MOCKS Y APAGADO DE NUBE (Spring Cloud GCP)
  cloud:
    gcp:
      project-id: test-project
      pubsub:
        enabled: false # Apagamos conexi贸n real, usamos Mock PubSubTemplate
      credentials:
        location: classpath:non-existent-credentials.json

# SEGURIDAD (Valores Dummy para firmar/validar tokens en tests)
application:
  security:
    jwt:
      # Debe coincidir con la longitud m铆nima de HMAC-SHA256
      secret-key: test-secret-key-must-be-very-long-for-hmac-sha-algorithm-at-least-256-bits

# CONFIGURACIN GCP DUMMY (Para inyecci贸n de @Value)
gcp:
  bucket-name: test-catalog-images
  pubsub:
    topic:
      catalog: test-catalog-topic
    subscription:
      system: test-system-sub

# STORAGE STRATEGY (Aunque usemos Mock, definimos provider para evitar nulls)
storage:
  provider: minio

# MINIO CONFIG (Valores Dummy)
minio:
  url: http://localhost:9000
  access-key: test-access
  secret-key: test-secret
  bucket-name: test-catalog-images

# LOGGING
logging:
  level:
    root: INFO
    # Debug para ver nuestros logs de creaci贸n/eventos
    com.quhealthy: DEBUG
    # Debug para ver los queries espaciales generados por Hibernate
    org.hibernate.SQL: DEBUG